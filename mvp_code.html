<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Getting Started with Code | Laravel URL Shortener Guide</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/tinyuri/assets/css/0.styles.d2ccf6e6.css" as="style"><link rel="preload" href="/tinyuri/assets/js/app.3bb2924c.js" as="script"><link rel="preload" href="/tinyuri/assets/js/2.a48eb182.js" as="script"><link rel="preload" href="/tinyuri/assets/js/15.3a6bf7d5.js" as="script"><link rel="prefetch" href="/tinyuri/assets/js/10.6d1ed9c6.js"><link rel="prefetch" href="/tinyuri/assets/js/11.95d99df8.js"><link rel="prefetch" href="/tinyuri/assets/js/12.f1f697df.js"><link rel="prefetch" href="/tinyuri/assets/js/13.9ce1fb47.js"><link rel="prefetch" href="/tinyuri/assets/js/14.4cebca7a.js"><link rel="prefetch" href="/tinyuri/assets/js/16.09b13ee9.js"><link rel="prefetch" href="/tinyuri/assets/js/17.37ce4089.js"><link rel="prefetch" href="/tinyuri/assets/js/18.7b9085b3.js"><link rel="prefetch" href="/tinyuri/assets/js/19.bd1170b4.js"><link rel="prefetch" href="/tinyuri/assets/js/20.4a35bc46.js"><link rel="prefetch" href="/tinyuri/assets/js/3.f153be8f.js"><link rel="prefetch" href="/tinyuri/assets/js/4.4d31d94d.js"><link rel="prefetch" href="/tinyuri/assets/js/5.4e7a2df9.js"><link rel="prefetch" href="/tinyuri/assets/js/6.498ab014.js"><link rel="prefetch" href="/tinyuri/assets/js/7.7e550121.js"><link rel="prefetch" href="/tinyuri/assets/js/8.fbde365e.js"><link rel="prefetch" href="/tinyuri/assets/js/9.b751af4a.js">
    <link rel="stylesheet" href="/tinyuri/assets/css/0.styles.d2ccf6e6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/tinyuri/" class="home-link router-link-active"><!----> <span class="site-name">Laravel URL Shortener Guide</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/tinyuri/" class="nav-link">
  Guide
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/tinyuri/" class="nav-link">
  Guide
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Guide</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tinyuri/setting_up.html" class="sidebar-link">Setting up a project</a></li><li><a href="/tinyuri/mvp_design.html" class="sidebar-link">Planning</a></li><li><a href="/tinyuri/mvp_code.html" aria-current="page" class="active sidebar-link">Getting Started with Code</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tinyuri/mvp_code.html#creating-our-first-model" class="sidebar-link">Creating our first model</a></li><li class="sidebar-sub-header"><a href="/tinyuri/mvp_code.html#creating-a-test" class="sidebar-link">Creating a test</a></li><li class="sidebar-sub-header"><a href="/tinyuri/mvp_code.html#creating-our-second-test-and-endpoint" class="sidebar-link">Creating our second test and endpoint</a></li><li class="sidebar-sub-header"><a href="/tinyuri/mvp_code.html#creating-the-basic-frontend" class="sidebar-link">Creating the basic frontend</a></li><li class="sidebar-sub-header"><a href="/tinyuri/mvp_code.html#what-s-next" class="sidebar-link">What's next</a></li></ul></li><li><a href="/tinyuri/basic_style.html" class="sidebar-link">Basic styling</a></li><li><a href="/tinyuri/first_feature.html" class="sidebar-link">First feature</a></li><li><a href="/tinyuri/cleanup.html" class="sidebar-link">Refactoring</a></li><li><a href="/tinyuri/users.html" class="sidebar-link">Authentication</a></li><li><a href="/tinyuri/relationships.html" class="sidebar-link">Relationships</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="getting-started-with-code"><a href="#getting-started-with-code" class="header-anchor">#</a> Getting Started with Code</h1> <h2 id="creating-our-first-model"><a href="#creating-our-first-model" class="header-anchor">#</a> Creating our first model</h2> <p>The first thing we are going to want to do is make our data model, like most modern frameworks, Laravel comes with some very robust database migration tools. You can read more about database migrations and how to use them <a href="laravel.com/docs/8.x/migrations">here</a>. So our first and only table right now is going to be the <code>urls</code> table and we will create it by using the <code>php artisan</code> command:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>php artisan make:migration create_urls_table
</code></pre></div><p>This is going to create a new file in our <code>database/migrations</code> folder with the following automatically generated:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Migrations<span class="token punctuation">\</span>Migration</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Schema<span class="token punctuation">\</span>Blueprint</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Schema</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">CreateUrlsTable</span> <span class="token keyword">extends</span> <span class="token class-name">Migration</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * Run the migrations.
     *
     * @return void
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">up</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name static-context">Schema</span><span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'urls'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token class-name type-declaration">Blueprint</span> <span class="token variable">$table</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">timestamps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Reverse the migrations.
     *
     * @return void
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">down</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name static-context">Schema</span><span class="token operator">::</span><span class="token function">dropIfExists</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'urls'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>By default our table is almost fully setup, we only need to add one additional column which is the <code>varchar</code> column <code>url</code>. In laravel database migrations we will use the <a href="https://laravel.com/docs/8.x/migrations#column-method-string" target="_blank" rel="noopener noreferrer"><code>string</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> method for our urls like so:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">Schema</span><span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'urls'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token class-name type-declaration">Blueprint</span> <span class="token variable">$table</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token keyword type-declaration">string</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">timestamps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>After we have defined our migration we need to run it. If you have not setup mysql you may need to do that before as well as create the database for this project. Whatever you name your database, you will need to update in your <code>.env</code> file under <code>DB_DATABASE</code> to reflect the correct name. Once that is done we want to run our migrations:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>php artisan migrate
</code></pre></div><p>we should see some output similar to the following:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>Migration table created successfully.
Migrating: 2014_10_12_000000_create_users_table
Migrated:  2014_10_12_000000_create_users_table <span class="token punctuation">(</span><span class="token number">35</span>.59ms<span class="token punctuation">)</span>
Migrating: 2014_10_12_100000_create_password_resets_table
Migrated:  2014_10_12_100000_create_password_resets_table <span class="token punctuation">(</span><span class="token number">20</span>.03ms<span class="token punctuation">)</span>
Migrating: 2019_08_19_000000_create_failed_jobs_table
Migrated:  2019_08_19_000000_create_failed_jobs_table <span class="token punctuation">(</span><span class="token number">20</span>.36ms<span class="token punctuation">)</span>
Migrating: 2021_03_21_152342_create_urls_table
Migrated:  2021_03_21_152342_create_urls_table <span class="token punctuation">(</span><span class="token number">6</span>.99ms<span class="token punctuation">)</span>
</code></pre></div><p>We can now check our database either through the mysql cli or an app like <a href="https://apps.apple.com/us/app/sequel-ace/id1518036000?mt=12" target="_blank" rel="noopener noreferrer">sequel ace<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to see that our database has populated the new table with the correct schema. The next thing we will want to do is add the corresponding model to our code so we can reference the table. We can read in depth about Laravel's ORM, Eloquent, and how to generate models <a href="https://laravel.com/docs/8.x/eloquent#generating-model-classes" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <div class="language-sh extra-class"><pre class="language-sh"><code>php artisan make:model Url
</code></pre></div><p>If we had wanted to do this quicker in one step we could have done:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>php artisan make:model Url --migration
</code></pre></div><p>which would have created both the model and the migration, but for tutorials sake we want to be more explicit and go through each step individually. We should now see a new file in <code>app/models</code> directory called <code>Url.php</code>. It should look something like this:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Models</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Factories<span class="token punctuation">\</span>HasFactory</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Url</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">HasFactory</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div><h2 id="creating-a-test"><a href="#creating-a-test" class="header-anchor">#</a> Creating a test</h2> <p>Before we continue any further with our application we are going to write a test for the expected behavior of our application. We are going to go to the <code>tests/Feature</code> folder and create a new file called <code>UrlTest.php</code>, we can do this manually or we can use the corresponding artisan command for it:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>php artisan make:test UrlTest
</code></pre></div><p>We are going to start with just the beginning of a test. We want to assert that you can <code>POST</code> to a <code>/url</code> endpoint with a parameter <code>url</code> and receive a 200 response:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">test_we_create_a_url_record</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/api/url'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'https://www.google.com'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$response</span><span class="token operator">-&gt;</span><span class="token function">assertStatus</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>If we go back to the terminal and run this command we are going to see that we have a failing test!</p> <div class="language-sh extra-class"><pre class="language-sh"><code>There was <span class="token number">1</span> failure:

<span class="token number">1</span><span class="token punctuation">)</span> Tests<span class="token punctuation">\</span>Feature<span class="token punctuation">\</span>UrlTest::test_example
Expected status code <span class="token number">200</span> but received <span class="token number">404</span>.
Failed asserting that <span class="token number">200</span> is identical to <span class="token number">404</span>.
</code></pre></div><p>In order to make that pass, lets go over and create a new route that returns success when you post above. We can make a route by going into our web route file <code>web.php</code> and add a new post route matching what is in our test:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/url'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string single-quoted-string">'success'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If we run the tests again they should all be green now, but we aren't exactly doing anything at all yet. The next step is to assert that we have a row with the supplied url in our database so we are going to update our test slightly:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">test_we_create_a_url_record</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'https://www.google.com'</span><span class="token punctuation">;</span>
    <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/url'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span> <span class="token operator">=&gt;</span> <span class="token variable">$url</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token variable">$response</span><span class="token operator">-&gt;</span><span class="token function">assertStatus</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">assertDatabaseHas</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'urls'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'url'</span> <span class="token operator">=&gt;</span> <span class="token variable">$url</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>What we are doing here now is we are checking that the database table <code>urls</code> has a row where <code>url</code> equals the value of whatever we have set <code>$url</code> to. We can read more about some of the available database assertions available to us <a href="https://laravel.com/docs/8.x/database-testing#available-assertions" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Our next step is now to see if we can have this endpoint create a new row in the database. Some of you will be wondering why we have not created a controller yet. For the time being we are trying to do the minimal amount of work to get this test working, afterwards we will definitely make sure to move this code into a more appropriate place but for now lets see what we need to do.</p> <p>At the top of our <code>web.php</code> file we are going to want to include or url model with a use statement as well as a request object:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Url</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Request</span><span class="token punctuation">;</span>
</code></pre></div><p>and then within our route we want to access the posted body and create a new Url like the following:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/url'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Request</span> <span class="token variable">$request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name static-context">Url</span><span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'url'</span> <span class="token operator">=&gt;</span> <span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token function">input</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string single-quoted-string">'success'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If we go back and run our test now we would expect it to succeed but it is not, and unfortunately we are not getting a lot of helpful information because all we see is that we received a 500 error instead of a 200 error. We are not seeing what that 500 error is because our server handles exceptions gracefully when hit by a user. To stop the graceful exception handling we should be able to get to the bottom of this. We can do this by adding the following to the beginning of our test:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">withoutExceptionHandling</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If we re-run the test we should now see a long stack trace that starts with the following:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>MassAssignmentException: Add <span class="token punctuation">[</span>url<span class="token punctuation">]</span> to fillable property to allow mass assignment on <span class="token punctuation">[</span>App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Url<span class="token punctuation">]</span>.
</code></pre></div><p>After referring to the documentation we can see that we need to add a property on our model, <code>$fillable</code> with the attributes that can be filled by user input. So we will go to our <code>Url.php</code> model and add the following:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">protected</span> <span class="token variable">$fillable</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'url'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>and try running our test one more time. Finally we have success! We now have an endpoint that can be hit with a url, that url will then be stored in our database with an id and a url. The last piece we will want to assert is that it returns the id of that new row. Let's update our test one last time:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">test_we_create_a_url_record</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">withoutExceptionHandling</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'https://www.google.com'</span><span class="token punctuation">;</span>
    <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/url'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span> <span class="token operator">=&gt;</span> <span class="token variable">$url</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token variable">$response</span><span class="token operator">-&gt;</span><span class="token function">assertStatus</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">assertDatabaseHas</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'urls'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'url'</span> <span class="token operator">=&gt;</span> <span class="token variable">$url</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$row</span> <span class="token operator">=</span> <span class="token class-name static-context">Url</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">,</span> <span class="token variable">$url</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$response</span><span class="token operator">-&gt;</span><span class="token function">assertSee</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token operator">-&gt;</span><span class="token property">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>If we run the test now we will see an error like so: <code>Failed asserting that 'success' contains &quot;1&quot;.</code>, so lets add some code to return what we were hoping for to our <code>web.php</code> route.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/url'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Request</span> <span class="token variable">$request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token class-name static-context">Url</span><span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'url'</span> <span class="token operator">=&gt;</span> <span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token function">input</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token variable">$url</span><span class="token operator">-&gt;</span><span class="token property">id</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>All we've done here is assigned the newly created row to a variable and returned its <code>id</code>. Now if we run the test for the last time we should see success, but... of course, we do not.</p> <div class="language-sh extra-class"><pre class="language-sh"><code>Failed asserting that <span class="token string">'3'</span> contains <span class="token string">&quot;1&quot;</span><span class="token builtin class-name">.</span>
</code></pre></div><p>What this is telling me is that we returned the <code>id</code> 3 but were expecting <code>id</code> 1. When we think logically, we have run the test 3 times and created 3 Urls. So our database is not being emptied each time, looking through the Laravel <a href="https://laravel.com/docs/8.x/database-testing#resetting-the-database-after-each-test" target="_blank" rel="noopener noreferrer">documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> one more time we can see we are missing something to clear out our database after every test. We need to add <code>Illuminate\Foundation\Testing\RefreshDatabase</code> to our test for it to clear our database after every test. In general I always want this functionality for all of my tests so instead of putting it in every test I'm going to put it in our base test class <code>tests/TestCase.php</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">Tests</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Testing<span class="token punctuation">\</span>TestCase</span> <span class="token keyword">as</span> BaseTestCase<span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Testing<span class="token punctuation">\</span>RefreshDatabase</span><span class="token punctuation">;</span>

<span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">TestCase</span> <span class="token keyword">extends</span> <span class="token class-name">BaseTestCase</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">CreatesApplication</span><span class="token punctuation">,</span> RefreshDatabase<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>And now when I run my tests one more time it is working as expected. We now have an endpoint that generates a <code>url</code> model and returns the <code>id</code>!</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>By default phpunit is going to use the same database as your application locally. If you use <code>RefreshDatabase</code> this will wipe out all your local data everytime you run your tests. It is highly recommended you create a second database like <code>tinyuri_test</code> and update your <code>phpunit.xml</code> file like so:</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>server</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DB_CONNECTION<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mysql<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>server</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DB_DATABASE<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tinyuri_test<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre></div></div> <h2 id="creating-our-second-test-and-endpoint"><a href="#creating-our-second-test-and-endpoint" class="header-anchor">#</a> Creating our second test and endpoint</h2> <p>Now we need one more endpoint for our application which will redirect users to their desired destinations. We are going to create another test in the same <code>tests/UrlTest.php</code> file. We want to assert that if you visit <code>/url/{id}</code> it redirects the user to the expected url. In Laravel's <a href="https://laravel.com/docs/8.x/http-tests#assert-redirect" target="_blank" rel="noopener noreferrer">testing documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> we can see that there is a <code>assertRedirect</code> which will be exactly what we need:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">test_we_redirect_users_to_url</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token class-name static-context">Url</span><span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'https://www.google.com'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;/url/<span class="token interpolation"><span class="token variable">$url</span><span class="token operator">-&gt;</span><span class="token property">id</span></span>&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$response</span><span class="token operator">-&gt;</span><span class="token function">assertRedirect</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token operator">-&gt;</span><span class="token property">url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>If we run this test it is going to fail, due to the route not existing, this one is not going to take many steps to get just right though. Due to something called <a href="https://laravel.com/docs/8.x/routing#route-model-binding" target="_blank" rel="noopener noreferrer">implicit route model binding<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> this next step is going to be incredibly easy! By just creating a route like the following:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/url/{url}'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token class-name type-declaration">Url</span> <span class="token variable">$url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token operator">-&gt;</span><span class="token property">url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Directly from the documentation you can see:</p> <blockquote><p>Laravel automatically resolves Eloquent models defined in routes or controller actions whose type-hinted variable names match a route segment name.</p></blockquote> <p>So we immediately have access to the model through said route binding. By returning a redirect to that model's <code>url</code> property we now have a passing test! This is a great time to take a step back and see your action in work. Although we don't have any UI to make urls, lets go ahead and create one in the database manually. You can either use some sort of OS native MySQL client, your CLI or you can use Laravel's <a href="https://laravel.com/docs/8.x/artisan#tinker" target="_blank" rel="noopener noreferrer">tinker<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> REPL. In this case we are going to try out the REPL:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>php artisan tinker
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> use App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Url<span class="token punctuation">;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Url::create<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'url'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'https://www.google.com'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">=</span><span class="token operator">&gt;</span> App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Url <span class="token punctuation">{</span>#4219
     url: <span class="token string">&quot;https://www.google.com&quot;</span>,
     updated_at: <span class="token string">&quot;2021-03-21 22:10:11&quot;</span>,
     created_at: <span class="token string">&quot;2021-03-21 22:10:11&quot;</span>,
     id: <span class="token number">1</span>,
   <span class="token punctuation">}</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token builtin class-name">exit</span>
</code></pre></div><p>we now can look in our database and we can see that we have a row in our database with an id of 1. If we now start our server:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>php artisan serve
Starting Laravel development server: http://127.0.0.1:8000
<span class="token punctuation">[</span>Sun Mar <span class="token number">21</span> <span class="token number">18</span>:11:36 <span class="token number">2021</span><span class="token punctuation">]</span> PHP <span class="token number">7.4</span>.13 Development Server <span class="token punctuation">(</span>http://127.0.0.1:8000<span class="token punctuation">)</span> started
</code></pre></div><p>and visit <code>http://127.0.0.1:8000/url/1</code> we will be redirected to google! We now have almost a full MVP of our url shortener, all that is left is adding the frontend code.</p> <h2 id="creating-the-basic-frontend"><a href="#creating-the-basic-frontend" class="header-anchor">#</a> Creating the basic frontend</h2> <p>The first thing we are going to need to do is create a basic page with a form to submit urls. We are going to create a new view to let users submit their urls.</p> <p>The first thing we are going to have to do is create a new file <code>views/urls/create.blade.php</code>. We are going to put some basic html in the blade:</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Shorten a link<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
        It works!
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>we are now going to hook this up to our root url by adjusting <code>web.php</code> to go from rendering the <code>welcome</code> view to our new <code>urls.create</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'urls.create'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>While we are in here we are also going to add a name to our route we use to create our urls like so:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/url'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Request</span> <span class="token variable">$request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token class-name static-context">Url</span><span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'url'</span> <span class="token operator">=&gt;</span> <span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token function">input</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token variable">$url</span><span class="token operator">-&gt;</span><span class="token property">id</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'create'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Named routes give a nice benefit of both resolving full paths automatically as well as remaining constant even if the url changes. It will help us with our form creation. If we refresh <code>localhost:8000</code> now we should see our &quot;It works!&quot; in the browser. Next we just need to add a form that will post to our desired endpoint.</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- views/urls/create.blade.php --&gt;</span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>POST<span class="token punctuation">&quot;</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{ route(<span class="token punctuation">'</span>create<span class="token punctuation">'</span>) }}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        @csrf
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>url-input<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>URL:
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>url-input<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>url<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>Submit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>After we have done this we should now successfully be able to create a shortened url; however the experience is less than ideal right now. Ideally we want to be redirected back to the original page with a success message and the url for the shortened link.</p> <p>To do this we need to change our post endpoint from returning data directly to redirecting back to our root url with some basic data. We are going to need to use Laravel's <a href="https://laravel.com/docs/8.x/responses#redirecting-with-flashed-session-data" target="_blank" rel="noopener noreferrer">redirect with session data<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// web.php</span>
<span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$urlId</span> <span class="token operator">=</span> <span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'urlId'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'urls.create'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'urlId'</span> <span class="token operator">=&gt;</span> <span class="token variable">$urlId</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'home'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/url'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Request</span> <span class="token variable">$request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token class-name static-context">Url</span><span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'url'</span> <span class="token operator">=&gt;</span> <span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token function">input</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'home'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">with</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'urlId'</span> <span class="token operator">=&gt;</span> <span class="token variable">$url</span><span class="token operator">-&gt;</span><span class="token property">id</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'create'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>with these updated routes we are now redirecting the user back to the root url where the user submitted their url with the id of their submitted url stored in session data. We have named our root url as <code>home</code> and we are getting that data and passing it to the view with the following code:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$urlId</span> <span class="token operator">=</span> <span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'urlId'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'urls.create'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'urlId'</span> <span class="token operator">=&gt;</span> <span class="token variable">$urlId</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If we run our tests again at this point they will now not all pass. We have changed the expected effect of our create url endpoint and we should update our test to reflect it. We still want to ensure that a new row is created in the database, but we now want to ensure we are redirected to the correct place and that the correct data is passed in the user's session.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// tests/Feature/UrlTest.php</span>

<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">test_we_create_a_url_record</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'https://www.google.com'</span><span class="token punctuation">;</span>
    <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/url'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span> <span class="token operator">=&gt;</span> <span class="token variable">$url</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">assertDatabaseHas</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'urls'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'url'</span> <span class="token operator">=&gt;</span> <span class="token variable">$url</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$row</span> <span class="token operator">=</span> <span class="token class-name static-context">Url</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">,</span> <span class="token variable">$url</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token variable">$response</span><span class="token operator">-&gt;</span><span class="token function">assertRedirect</span><span class="token punctuation">(</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'home'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$response</span><span class="token operator">-&gt;</span><span class="token function">assertSessionHas</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'urlId'</span> <span class="token operator">=&gt;</span> <span class="token variable">$row</span><span class="token operator">-&gt;</span><span class="token property">id</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>if we now add to our <code>create.blade.php</code> the following we should see some data after creating a url:</p> <div class="language-html extra-class"><pre class="language-html"><code>@if ($urlId)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{ $urlId }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
@endif
</code></pre></div><p>If we have done everything right we should now see the following:</p> <img src="/tinyuri/05_website_mvp_pre.png" alt="website mvp"> <p>We are getting very close, we now have the id but to an end user this is not a great experience, we really want to display to the user the full url they need to get their redirect working. We are going to need one last named route:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// web.php</span>
<span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/url/{url}'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token class-name type-declaration">Url</span> <span class="token variable">$url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token operator">-&gt;</span><span class="token property">url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'shortened'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>And with the <code>shortened</code> name for that route we can use the second parameter of the <code>route()</code> function to pass in an id and form a full url:</p> <div class="language-html extra-class"><pre class="language-html"><code>@if ($urlId)
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{ route('shortened', ['url' =&gt; $urlId]) }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
@endif
</code></pre></div><p>If we go through the process one more time we should now see a fully formed url! Congratulations, we have our most basic MVP of our product. It is not pretty but it is completely functional, its possible going through this process has piqued some ideas about other features or shortcomings of what we currently have.</p> <h2 id="what-s-next"><a href="#what-s-next" class="header-anchor">#</a> What's next</h2> <p>There are few items that came to my mind while going through this process, the first and most glaring being that our shortened urls are just numbers. Here is a list of a few things that come to mind immediately:</p> <ol><li>There is no styling, basically our site is very ugly</li> <li>Shortened urls are just numbers and will not stay short for nearly as long as if letters were included.</li> <li>There is no validation when submitting a url</li> <li>Would be nice to be able to have a user and see all redirects created</li> <li>Would be nice to be able to see how many people have visited your shortened link</li> <li>It would be great to allow for custom vanity urls</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/tinyuri/mvp_design.html" class="prev">
        Planning
      </a></span> <span class="next"><a href="/tinyuri/basic_style.html">
        Basic styling
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/tinyuri/assets/js/app.3bb2924c.js" defer></script><script src="/tinyuri/assets/js/2.a48eb182.js" defer></script><script src="/tinyuri/assets/js/15.3a6bf7d5.js" defer></script>
  </body>
</html>
